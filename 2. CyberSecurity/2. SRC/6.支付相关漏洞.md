# 支付相关漏洞

## 漏洞介绍

支付漏洞一般都是危害性比较的大，凡是涉及购买、提现，自动续费，兑换礼品，充值，等方面的功能处就有可能存在支付问题，比如0元购买，购买多次，无限刷优惠卷等等

## 漏洞原理

正常线上购物的三个步骤, 每一个都有漏洞. 

1. 购买
2. 生成订单信息(地址, 号码, 数量, 价格)
3. 支付

在选品阶段订单金额任意修改, 可以变成原本100元的商品,可以使用1元甚至其他的价格进行购买. 



## 具体的操作步骤

1. 正常登录

2. 抓包, 正常的购买某个产品并截取数据包

3. 找到对应订单价格的参数, 进行修改(加入订单是`price = 5000`)

   ```
   1. 双写, 改成无穷大, 改小, 改负, 拼接, 特殊字符. 
   2. 非订单参数, 会不会影响呢? 直接fuzz 页面的其他的参数. 
   ```

## 注意

**假如真的挖到了支付漏洞, 比如可以用`0.5`元, 买个 `上千块`的iPhone, 那么先不要着急支付, 先打开录屏软件,开始进行录屏已保留证据.** 

运气好的, 也行SRC不会取消订单, 也就是说订单仍然成立. 反正不要买太贵的就是行. (几百的也许可以, 几千的可以试试.)

# 技巧

> 一些企业的内部的采购页面, 隐藏比较深的页面可能会存在. 

1. 内部严选
2. app
3. 非常小的, **不起眼的, 隐藏部分**的充值
4. 关注 **积分, 虚拟产品, 实体商城, 不要局限于 money的充值.**

> 不仅仅可以改价格, 还可以其他的

1. 除了价格,能不能修改颜色?  比如某产品没有某个颜色的, 但是如果非法人员将某个存在的正常销售的产品比如白色, 改成了一个 不存在的. 这样就会达到欺骗商家的目的, 这个时候不就可以索赔了吗?   
2. 类型/  型号 / ? 
3. 除了 改参数, 能不能 **加** 参数呢? 

> 4.购买的过程是由前面提到的三个部分组成的, 分别对三个部分进行测试, 改参数不也是一种尝试吗?

5. 常见的改参数方法

```
1. 将大额改小额
2. 负数 购买   , 还可以利用负数进行价格的拼凑, 将大数改小数   
               例如: 购买两个产品, 一个正常购买, 另一个 将其改为负数, 两个产品总价个 不就是 正减负 吗? 
3. 
```

6. 购买的时候不要只盯着数量, 还有金额, 后者其他的隐藏参数. 
7. 某些网站存在金额校验, 可以把数值改为 1 元 之类的. 

# 谨记

**增删改查 , 走天下!!!!!!!**

**挖洞挖到最后就是Fuzz!!!**

**万物皆可改, 啥都可以改**

主要还是靠 **思维, 逻辑**

**对于支付类的逻辑漏洞,  眼睛看到的都可以改**

--------------



> 下面对支付漏洞 , 作一些相对具体的介绍

--------------



## 越权支付漏洞

### 原理

越权支付一般存在提功，或者使用余额支付，或者使用积分之类的的页面，通过修改可以越权的字段，从而使用他人的余额进行支付 . `此漏洞的核心就是越权`

### 注意

1. 如果有越权支付漏洞那么可能不仅仅有 **支付漏洞**, 大概率还有**越权**啊. 或者还有其他的漏洞.  

2. 总之, 为了网络的安全, 为了体现人们的专业性, 将同一个漏洞分成多个报告进行提交. Nice!  (以漏洞造成的危害进行报告提交, 不仅仅是漏洞名字.)

   > 举例: 
   >
   > 1. **发现**越权漏洞
   > 2. 越权后发现 **越权支付漏洞**
   > 3. 越权后发现 **越权任意查看漏洞**
   > 4. **提交** 越权漏洞

### 具体流程

仍然是 `增删改查`, 抓包删除某个字段看能不能过, 如果不能过, 那大概率`那个字段是和权限相关的`. **或者寻找id之类的字段**, 将自己的身份改为别人的. 



## 修改优惠券

直接抓包, 对优惠券进行修改. 

### 技巧

```
1. 可以重放优惠券, 看能不能一直领取
2. 可以修改优惠券的类别, 看能不能小金额购买
3. 遍历优惠券id.       可能遍历出测试隐藏的无条件的大额优惠券
4. 双写优惠卷, 看能不能 一张 当成 两张 用
5. 越权使用他人优惠券.
```

## 修改运费

```
直接修改运费
```

## 四舍五入漏洞

比如: 服务器最多识别两位小数, 我们在充值的时候, 充值了 `0.299`,那么服务器就会根据四舍五入原则进行计算, 最终薅羊毛, 多充值`0.001`.

试想, 如果写个脚本, 进行循环n次呢?

> 漏洞不需要任何的工具, 直接正常操作就完事了.



## 无限利用优惠

**这个漏洞也不需要啥工具, 只要手机多就行!**

### 原理

首充优惠、升级会员，使用优惠券等，只要是有优惠的地方都可以采用如下的方式进行漏洞挖掘

**低价签约**

1. 第一步: 使用手机A 登录账号A，打开要测试的业务，点击自动续费，支付时停留在支付的页面，**不要支付**, 

2. 第二步:使用手机B 登录账号A，打开要测试的业务，点击自动续费，支付时停留在支付的页面，**不要支付**, 重复多台手机进行同样操作A手机点击支付进行签约A手机支付成功后，**在第三方APP中解除自动续费B手机进行支付**，支付成功后在第三方APP中解除自动续费全部支付完成后，系统就会为你开通相应的次数，由于提前打开了支付页面，所以金额都是享受到新用户首月优惠的金额，然后你就会发现你开通的时间在不断叠加

**低价会员升级**

1. 第一步: 使用A手机登陆账号A，并且开通会员。开通超级会员，进入到升级页面，进行补齐差价开通。
2. 第二步: 使用B手机登陆账号A，点击开通超级会员，进入到升级页面，进行补齐差价开通。A手机进行支付，B手机进行支付。服务器认为你补齐了多个月份的超级会员，然后到账多次。

**无限优惠券**

1. 第一步: 使用A手机登陆账号A， 发起酒店定单（并勾选该优惠券）进入支付宝支付页面，**先不支付**；
2. 第二步: 使用B手机登陆账号A， 发起酒店定单（并勾选该优惠券）进入支付宝支付页面，先不支付；
3. 第三步: 使用C手机登陆账号A， 发起酒店定单（并勾选该优惠券）进入支付宝支付页面，选择支付其他也选择支付，就可以发现有3个订单，同时使用了优惠券

**总之, 手机多就行**



## 整数溢出漏洞

### 原理

计算机识别的 `int`根据二进制是有范围的, 如果超过最大值, 那么会接着循环从最小的开始. 

**int范围是`-2147483648 到 2147483647`** , 当超过最大的时候, 就会出现`2147483649 = -2147483646`, 有的时候支付里面没有负数, 可能从0开始





# 总结

虽然操作看起来很简单, 但是由于数据包中的**字段有很多很多**, 不易寻找, 所以, 需要先在浏览器中看一下, F12 . 看看到底有啥.找到主包. 看一下 **Network**就行. 

![image-20230529193837099](https://raw.githubusercontent.com/QDGSCLOUD/BJYH_picture/main/img/image-20230529193837099.png)

























